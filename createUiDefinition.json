{
    "handler": "Microsoft.Compute.MultiVm",
    "version": "0.0.1-preview",
    "parameters": {
        "basics": [
            {
                "name": "dnsNameForPublicIP",
                "type": "Microsoft.Common.TextBox",
                "label": "F5 WAF Cluster Name",
                "defaultValue": "f5wafcl01",
                "constraints": {
                    "required": true,
                    "regex": "^[a-z0-9A-Z]{1,10}$",
                    "validationMessage": "Only letters and numbers are allowed, and the value must be 1-10 characters long."
                }
            }
        ],
        "steps": [
            {
                "name": "infrastructureConfig",
                "label": "Infrastructure Settings",
                "subLabel": {
                    "preValidation": "Configure Infrastructure Settings for the F5 WAF Cluster",
                    "postValidation": "Done"
                },
                "bladeTitle": "Infrastructure Settings",
              "elements": [
                {
                  "name": "adminUsername",
                  "type": "Microsoft.Compute.UserNameTextBox",
                  "label": "Username",
                  "toolTip": "Admin username for the virtual machines. Same Credientials is to SSH to the box.",
                  "osPlatform": "Linux"
                },
                {
                  "name": "SSHCredntials",
                  "type": "Microsoft.Compute.CredentialsCombo",
                  "label": {
                    "authenticationType": "Authentication type",
                    "password": "Password",
                    "confirmPassword": "Confirm password",
                    "sshPublicKey": "SSH public key"
                  },
                  "toolTip": {
                    "authenticationType": "",
                    "password": "",
                    "sshPublicKey": ""
                  },
                  "constraints": {
                    "required": true
                  },
                  "options": {
                    "hideConfirmation": false
                  },
                  "osPlatform": "Linux"
                },
                {
                  "name": "numberOFWAFs",
                  "type": "Microsoft.Common.DropDown",
                  "label": "Numbe of WAFs",
                  "defaultValue": "2",
                  "toolTip": "The number of individual F5 WAFs (nodes) to provision for this cluster.",
                  "constraints": {
                    "allowedValues": [
                      {
                        "label": "1",
                        "value": 1
                      },
                      {
                        "label": "2",
                        "value": 2
                      },
                      {
                        "label": "3",
                        "value": 3
                      },
                      {
                        "label": "4",
                        "value": 4
                      },
                      {
                        "label": "5",
                        "value": 5
                      },
                      {
                        "label": "6",
                        "value": 6
                      },
                      {
                        "label": "7",
                        "value": 7
                      },
                      {
                        "label": "8",
                        "value": 8
                      }
                    ]
                  }
                },
                {
                  "name": "clusterVmSize",
                  "type": "Microsoft.Compute.SizeSelector",
                  "label": "Virtual machine size",
                  "toolTip": "The size of virtual machine to provision for each cluster node.",
                  "recommendedSizes": [
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4"
                  ],
                  "constraints": {
                    "allowedSizes": [
                      "Standard_D1",
                      "Standard_D2",
                      "Standard_D3",
                      "Standard_D4"
                    ]
                  },
                  "osPlatform": "Linux",
                  "imageReference": {
                    "publisher": "Canonical",
                    "offer": "UbuntuServer",
                    "sku": "14.04.2-LTS"
                  },
                  "count": [ "steps('infrastructureConfig').numberOFWAFs" ]
                }
              ]
            },
            {
                "name": "f5WAFConfig",
                "label": "F5 WAF Config",
                "subLabel": {
                    "preValidation": "F5 WAF Configuration",
                    "postValidation": "Done"
                },
                "bladeTitle": "F5 WAF Configuration",
              "elements": [
                {
                  "name": "licenseToken1",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the first F5 WAF node.",
                  "constraints": {
                    "required": true,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken2",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the second F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken3",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the third F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken4",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the fourth F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken5",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the fifth F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken6",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the sixth F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken7",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the seventh F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                },
                {
                  "name": "licenseToken8",
                  "type": "Microsoft.Common.TextBox",
                  "label": "BYOL Token",
                  "toolTip": " BYOL Token for the eighth F5 WAF node.",
                  "constraints": {
                    "required": false,
                    "regex": "^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$",
                    "validationMessage": "Must be a valid fully-qualified domain name."
                  }
                }
              ]
            },
            {
                "name": "appSettings",
                "label": "Application Settings",
                "subLabel": {
                    "preValidation": "Configure Application Settings.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Application Settings",
              "elements": [
                {
                  "name": "applicationName",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Name",
                  "toolTip": "The name of the applicaiton that will be placed behind this WAF cluster to be protected.",
                  "constraints": {
                    "required": true
                  }
                },
                {
                  "name": "applicationProtocols",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Protocols",
                  "toolTip": "A semi-colon separated list of protocols (http;https) that will be used to configure the WAF's VIP's, (e.g. http for port 80 and https for SSL).",
                  "constraints": {
                    "required": true
                  }
                },
                {
                  "name": "applicationAddress",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Address",
                  "toolTip": "The public IP address or DNS FQDN of the Application that this WAF is for.",
                  "constraints": {
                    "required": true
                  }
                },
                {
                  "name": "applicationPorts",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Ports",
                  "toolTip": "A semi-colon separated list of ports, (80;443) that your applicaiton is listening on, (e.g. 80 and 443).",
                  "constraints": {
                    "required": true
                  }
                },
                {
                  "name": "applicationType",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Type",
                  "toolTip": "Is your application running on a Linux OS or a Windows OS?",
                  "constraints": {
                    "required": true
                  }
                },
                {
                  "name": "applicationFQDN",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application FQDN",
                  "toolTip": "The Fully Qualified Domain Name of your application. (e.g. www.example.com).",
                  "constraints": {
                    "required": true
                  }
                }
              ]
            },
            {
                "name": "securitySettings",
                "label": "Security Settings",
                "subLabel": {
                  "preValidation": "Configure Security Settings for this F5 WAF Cluster.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Security Settings",
              "elements": [
                {
                  "name": "blockingLevel",
                  "type": "Microsoft.Common.DropDown",
                  "label": "Security Blocking Level",
                  "constraints": {
                    "required": true,
                    "allowedValues": [
                      {
                        "label": "Generic - IIS",
                        "value": "windows"
                      },
                      {
                        "label": "Generic - Apache",
                        "value": "linux"
                      },
                      {
                        "label": "Generic - NGINX",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - Magento ",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - WooCommerce",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - BigCommerce",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - Volusion",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - Miva Merchant",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - Shopify",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - Demandware",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - osCommerce",
                        "value": "linux"
                      },
                      {
                        "label": "Shop - Generic",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - WordPress",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - Drupal",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - Joomla!",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - Blogger",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - vBulletin",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - ExpressionEngine",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - DNN Software",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - Adobe CQ",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - Ektron",
                        "value": "linux"
                      },
                      {
                        "label": "CMS - Sharepoint",
                        "value": "windows"
                      },
                      {
                        "label": "CMS - Generic",
                        "value": "linux"
                      }
                    ]
                  }
                },
                {
                  "name": "applicationCertificate",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Name",
                  "toolTip": "The path to the SSL certificate file. (Optional)",
                  "constraints": {
                    "required": false
                  }
                },
                {
                  "name": "applicationKey",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Name",
                  "toolTip": "The path to the SSL key file. (Optional)",
                  "constraints": {
                    "required": false
                  }
                },
                {
                  "name": "applicationChain",
                  "type": "Microsoft.Common.TextBox",
                  "label": "Application Name",
                  "toolTip": "The path to the SSL chain file. (Optional)",
                  "constraints": {
                    "required": false
                  }
                }
              ]
            }
        ],
      "outputs": {
        "location": "[location()]",
        "numberOFWAFs": "[steps('infrastructureConfig').numberOFWAFs]",
        "vmSize": "[steps('infrastructureConfig').clusterVmSize]",
        "dnsNameForPublicIP": "[basics('dnsNameForPublicIP')]",
        "adminUsername": "[steps('infrastructureConfig').adminUsername]",
        "adminPassword": "[steps('infrastructureConfig').SSHCredntials.password]",
        "licenseToken1": "[steps('f5WAFConfig').licenseToken1]",
        "licenseToken2": "[steps('f5WAFConfig').licenseToken2]",
        "licenseToken3": "[steps('f5WAFConfig').licenseToken3]",
        "licenseToken4": "[steps('f5WAFConfig').licenseToken4]",
        "applicationName": "[steps('appSettings').applicationName]",
        "applicationProtocols": "[steps('appSettings').applicationProtocols]",
        "applicationAddress": "[steps('appSettings').applicationAddress]",
        "applicationPorts": "[steps('appSettings').applicationPorts]",
        "applicationType": "[steps('appSettings').applicationType]",
        "applicationFQDN": "[steps('appSettings').applicationFQDN]",
        "blockingLevel": "[steps('securitySettings').blockingLevel]",
        "applicationCertificate": "[steps('securitySettings').applicationCertificate]",
        "applicationKey": "[steps('securitySettings').applicationKey]",
        "applicationChain": "[steps('securitySettings').applicationChain]"
      }
    }
}
